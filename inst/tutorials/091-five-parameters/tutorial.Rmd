---
title: Five Parameters
author: David Kane and Sanaka Dash
tutorial:
  id: five-parameters
output:
  learnr::tutorial:
    progressive: yes
    allow_skip: yes
runtime: shiny_prerendered
description: 'Chapter 9 Tutorial: Five Parameters'
---

```{r setup, include = FALSE}
library(learnr)
library(tutorial.helpers)
library(gt)

library(tidyverse)
library(brms)          # Delete soon
library(tidybayes)     # Delete soon
library(primer.data)
library(tidymodels)
library(marginaleffects)

knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 600, 
        tutorial.storage = "local") 

df1 <- governors |> 
  filter(year > 1945) |> 
  select(last_name, year, state, sex, lived_after, election_age)

df2 <- df1 |> mutate(sex = recode(sex,
    "Male" = 0, "Female" = 1))

 # fit_all <- lm(lived_after ~ sex * election_age, data = df2)

 # write_rds(fit_all, "data/fit_all.rds")

fit_all <- read_rds("data/fit_all.rds")

governor <- data.frame(sex = 1, election_age = 52)
```

```{r copy-code-chunk, child = system.file("child_documents/copy_button.Rmd", package = "tutorial.helpers")}
```

```{r info-section, child = system.file("child_documents/info_section.Rmd", package = "tutorial.helpers")}
```

<!-- DK: Lots of sloppiness everywhere in this tutorial. Too wordy. -->

## Introduction
### 

This tutorial supports [*Preceptor’s Primer for Bayesian Data Science: Using the Cardinal Virtues for Inference*](https://ppbds.github.io/primer/) by [David Kane](https://davidkane.info/). 

The world confronts us. Make decisions we must.

Imagine that you are someone who is considering running for governor. You want to find out what age is best to run for governor, because you will live the longest, theoretically at that age.



## The Question
### 

*A Prudent Question is one-half of wisdom.* - Francis Bacon

### Exercise 1

Load **tidyverse**.

```{r the-question-1, exercise = TRUE}

```

```{r the-question-1-hint-1, eval = FALSE}
library(tidyverse)
```

```{r the-question-1-test, include = FALSE}
library(tidyverse)
```

### 

We will be working with information about candidates for governor in the United States. The data was collected for “[Longevity Returns to Political Office](https://doi.org/10.1017/psrm.2019.63)” by Sebastian Barfort, Robert Klemmensen, and Erik Gahner Larsen ([pdf](https://github.com/PPBDS/primer.data/blob/master/inst/papers/governors.pdf)).

### Exercise 2

Load the **primer.data** package.

```{r the-question-2, exercise = TRUE}

```

```{r the-question-2-hint-1, eval = FALSE}
library(primer.data)
```

```{r the-question-2-test, include = FALSE}
library(primer.data)
```

### 

A version of the data from Barfort et al (2020) is available in the `governors` tibble, which is included in the **primer.data** package.


### Exercise 3

After loading **primer.data** in your Console, type `?governors` in the Console, and paste in the Description below.

```{r the-question-3}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

The abstract of the paper that the tibble is based on: 

> Does political office cause worse or better longevity prospects? Two perspectives in the literature offer contradicting answers. First, increased income, social status, and political connections obtained through holding office can increase longevity. Second, increased stress and working hours associated with holding office can have detrimental effects on longevity. To provide causal evidence, we exploit a regression discontinuity design with unique data on the longevity of candidates for US gubernatorial office. The results show that politicians winning a close election live 5–10 years longer than candidates who lose.

### Exercise 4

Longevity i.e., how long people live, is the broad topic of this tutorial. Given this topic, which variable in `governors` should we use as our outcome variable? 

*Hint:* It might be useful to preview the `governors` tibble in the Console (to get an idea of the columns)

```{r the-question-4}
question_text(NULL,
	message = "It would be most logical to use `lived_after`.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 2)
```

### 

We will use `lived_after` as our outcome variable.

```{r}
ggplot(df1, aes(x = lived_after)) +
  geom_histogram(fill = "steelblue", color = "black", bins = 30) +  # Adjusting the colors and bin size
  labs(
    title = "Distribution of Years Lived After Election",
    x = "Years Lived After Election",
    y = "Count"
  ) +
  theme_minimal(base_size = 15) +  # Increasing the base text size for readability
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 18),  # Centering and styling the title
    axis.title.x = element_text(size = 14),  # Adjusting x-axis label size
    axis.title.y = element_text(size = 14),  # Adjusting y-axis label size
    axis.text = element_text(size = 12)  # Adjusting axis text size
  ) +
  scale_x_continuous(breaks = seq(0, max(df1$lived_after, na.rm = TRUE), by = 5))  # Custom breaks for x-axis

```

### Exercise 5

Let's imagine a brand new variable which **does not exists** in the data. This variable should be binary, meaning that it only takes on one of two values. It should also, at least in theory, by manipulable. In other words, if the value of the variable is "X," or whatever, then it generates one potential outcome and if it is "Y," or whatever, it generates another potential outcome.

Describe this imaginary variable and how might we manipulate its value.

```{r the-question-5}
question_text(NULL,
	message = "We will use `exercise` as a treatment variable. If given a value of 1, they exercise regularly. If 0, they don't 0 at all, or very little. We can seperate these two by having a control group of governors who did not exercise regularly while they were in office, vs a groupd that did.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Any data set can be used to construct a causal model as long as there is at least one covariate that we can, at least in theory, manipulate. It does not matter whether or not anyone did, in fact, manipulate it. 


### Exercise 6

Given our (imaginary) treatment variable `exercise`, how many potential outcomes are there for each [governor: unit]? Explain why.


```{r the-question-6}
question_text(NULL,
	message = "There are two potential outcomes because the treatment variable `exercise` takes on two posible values: exercising regularly or not exercising regularly",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The same data set can be used to create, separately, lots and lots of different models, both causal and predictive. We can just use different outcome variables and/or specify different treatment variables. This is a *conceptual* framework we apply to the data. It is never inherent in the data itself. 

### Exercise 7

In a few sentences, specify the two different values for the imaginary treatment variable `exercise`, for a single unit, guess at the potential outcomes which would result, and then determine the causal effect for that unit given those guesses.

```{r the-question-7}
question_text(NULL,
	message = "For a given governor, assume that the value of the treatment variable might be 1, exrcising regularly or 0 not exrcising regularly. If the governor gets 1, then `lived_after` would be 75. If the governor gets 0, then `lived_after` would be 70. The causal effect on the outcome of a treatment of [exercising versus not exrcising is 75 - 70 --- i.e., the difference between two potential outcomes --- which equals 5 years, which is the causal effect.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The the definition of a causal effect is the difference between two potential outcomes. Of course, you can't just say that the causal effect is 10. The exact value depends on which potential outcome comes first in the subtraction and which second. There is, perhaps, a default sense in which the causal effect is defined as treatment minus control. 

Any causal connection means exploring the *within row* difference between two potential outcomes. We don't need to look at any other rows to have that conversation.

### Exercise 8

Let's consider a *predictive* model. Which variable in `governors` do you think might have an important connection to `lived_after`? 


```{r the-question-8}
question_text(NULL,
	message = "The covariate that is the most connected to `lived_affter` is eletion_age. If this were a predictive model, we would seek to predict how long a governor would live based on what age they were elected at.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 2)
```

### 

With a predictive model, there is only one outcome for each individual unit. There are not two potential outcomes because we are not considering any of the covariates to be a treatment variable. We assuming that the values of all covariates are "fixed." 

### Exercise 9

Specify two different groups of governors which have specific value for `age_elected` and which might have different average values for the `lived_after`.  

```{r the-question-9}
question_text(NULL,
	message = "For governors, the covariate age can be used to define two distinct groups. Group 1 consists of Younger Governors aged 40-50. This group is expected to have a higher average lived_after, potentially around 80 years, due to having more years ahead to live. Group 2 includes Older Governors aged 60-70. This group is expected to have a lower average lived_after, approximately 70 years, due to their advanced age. Comparing these groups helps understand how age impacts the longevity of governors.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

In predictive models, do not use words like "cause," "influence," "impact," or anything else which suggests causation. The best phrasing is in terms of "differences" between groups of units with different values for the covariate of interest.


### Exercise 10

Write a predictive question which connects the outcome variable `lived_after` to `age_elected`, the covariate of interest. 

```{r the-question-10}
question_text(NULL,
	message = "How does the covariate `age_elected` change the outcome variable `lived_after` among governors?",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

We call the answer to this question is your "Quantity of Interest." 

Our Quantity of Interest might appear too specific, too narrow to capture the full complexity of the topic. There are many, many numbers which we are interested in, many numbers that we want to know. But we don't need to list them all here! We just need to choose one of them since our goal is just to have a specific number which helps to guide us in the creation of the Preceptor Table and, then, the model.



## Wisdom
### 

*The only true wisdom is in knowing you know nothing.* - Socrates

### 

Our question:

> *How long do political candidates live after the election?*
<!-- SU: so just to clarify this is a predictive model, but we just used an imaginary variable up above to make it causal temporarily? -->

### Exercise 1

In your own words, describe the key components of Wisdom for working on a data science problem. 

```{r wisdom-1}
question_text(NULL,
	message = "Wisdom requires the creation of a Preceptor Table, an examination of our data, and a determination, using the concept of validity, as to whether or not we can (reasonably!) assume that the two come from the same population.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The central problem for Wisdom is: Can we use data from governors to understand the variables/relationships in the preceptors table?

### Exercise 2

Define a Preceptor Table.

```{r wisdom-2}
question_text(NULL,
	message = "A Preceptor Table is the smallest possible table of data with rows and columns such that, if there is no missing data, it is easy to calculate the quantities of interest.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The Preceptor Table does not include all the covariates which you will eventually include in your model. It only includes covariates which you need to answer your question.

### Exercise 3

Describe the key components of Preceptor Tables in general, without worrying about this specific problem.


```{r wisdom-3}
question_text(NULL,
	message = "The rows of the Preceptor Table are the units. The outcome is at least one of the columns. If the problem is causal, there will be at least two (potential) outcome columns. The other columns are covariates. If the problem is causal, at least one of the covariates will be a treatment.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

This problem is causal so one of the covariates is a treatment. In our problem, the treatment is the type of postcard that the resident receives. There is a potential outcome for each possible value of the treatment.
 
### Exercise 4

Create a Github repo called `tutorial-9`. Make sure to click the "Add a README file" check box.

Connect the Github repo to an R project on your computer. Give the R project the same name.

Select `File -> New File -> Quarto Document ...`. Provide a title -- `"[XX: Your Title]"` -- and an author (you). Render the document and save it as `XX.qmd`.

Edit the `.gitignore` by adding `*Rproj`. Save and commit this in the Git tab. Push the commit.

In the Console, run:

```         
show_file(".gitignore")
```
CP/CR.

```{r wisdom-4}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

### 

Remove everything below the YAML header from your QMD and render the file. `Command/Ctrl + Shift + K` first saves the file and then renders it.

### Exercise 5

What are the units for this problem?

HINT: Ask yourself "Who's being affected in this scenario?"

```{r wisdom-5}
question_text(NULL,
	message = "Our units for this problem would be individual candidates because the questions are about the life expectancy of those candidates.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Specifying the Preceptor Table forces us to think clearly about the units and outcomes implied by the question. The resulting discussion sometimes leads us to modify the question with which we started. No data science project follows a single direction. We always backtrack. There is always dialogue.

### Exercise 6

What is the outcome for this problem?

HINT: Ask yourself "What are we trying to get out of this problem?"

NOTE: The outcome is what WE want to get out of the data, based on our QUESTION. It does NOT concern the POSSIBLE values that we CAN extract.

```{r wisdom-6}
question_text(NULL,
	message = "The number of years a candidate lives after the election.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Regardless, the central lesson is always the same: *You can never look at your data too much.*


### Exercise 7

What are some covariates which you think might be useful for this problem, regardless of whether or not they might be included in the data?

```{r wisdom-7}
question_text(NULL,
	message = "Any variable that can be connected to the outcome variable is acceptable. We will use `sex`, `elections_age` and `year`",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The term "covariates" is used in at least three ways in data science. First, it is all the variables which might be useful, regardless of whether or not we have the data. Second, it is all the variables which we have data for. Third, it is the set of covariates which we end up using in the model.


### Exercise 8

What are the treatments, if any, for this problem?

```{r wisdom-8}
question_text(NULL,
	message = "Since this is a predictive model there is no treatment per se. Any variable which one might consider a treatment is just another covariate in this context.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Remember that a treatment is just another covariate which, for the purposes of this specific problem, we are assuming can be manipulated, thereby, creating two or more different potential outcomes for each unit.


### Exercise 9

What moment in time does the Preceptor Table refer to?

```{r wisdom-9}
question_text(NULL,
	message = "At this point in time, we don't know what moment in time it should cover because the question itself doesn't state any clear time frame. For all we know, it could include entries from the past, present, and even future!",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

```{r}
ggplot(df1, aes(x = election_age, y = lived_after, color = sex)) +
  geom_point() + 
  labs(title = "Years Lived After Election vs. Election Age",
       x = "Election Age",
       y = "Years Lived After Election") +
  theme_minimal()
```

<!-- SU: DO we still need these questions? It might confuse students on whether this is a causal or predictive model. -->

### Exercise 10

Define a causal effect.

```{r wisdom-10}
question_text(NULL,
	message = "A causal effect is the difference between two potential outcomes.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

According to the Rubin Causal Model, there must be two (or more) potential outcomes for any discussion of causation to make sense. This is simplest to discuss when the treatment only has two different values, thereby generating only two potential outcomes. 

### Exercise 11

What is the fundamental problem of causal inference?

```{r wisdom-11}
question_text(NULL,
	message = "The fundamental problem of causal inference is that we can only observe one potential outcome.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

If the treatment variable is continuous (like income), then there are lots and lots of potential outcomes, one for each possible value of the treatment variable

### Exercise 12

How does the motto "No causal inference without manipulation." apply in this problem?

```{r wisdom-12}
question_text(NULL,
	message = "The motto does not apply because this is a predictive, not causal, model.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 13

Describe in words the Preceptor Table for this problem.

```{r wisdom-13}
question_text(NULL,
	message = "Our Preceptor Table would contain a list of candidates on the right-hand side of the table, and on the left-hand side, would contain variables concerning their sex, the year that they got elected, the age at which they got elected, and the number of years that they lived after getting elected.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The Preceptor Table for this problem looks something like this:

```{r}
#| echo: false

tibble(ID = c("Candidate 1", "Candidate 2", "...", "Candidate 10", "Candidate 11", "...", "Candidate N"),
       lived_after = c("12", "7", "...", "10", "11", "...", "6"),
       year_elected = c("2000", "2012", "...", "2012", "2024", "...", "2050"),
       election_age = c("63", "47", "...", "52", "75", "...", "68"),
       sex = c("Female", "Male", "...", "Female", "Female", "...", "Male")) |>
  gt() |>
  tab_header(title = "Preceptor Table") |>
  cols_label(ID = md("ID"),
             lived_after = md("Years Lived After"),
             year_elected = md("Year of Election"),
             election_age = md("Age at Election"),
             sex = md("Sex")) |>
  tab_style(cell_borders(sides = "right"),
            location = cells_body(columns = c(ID))) |>
  tab_style(style = cell_text(align = "left", v_align = "middle", size = "large"), 
            locations = cells_column_labels(columns = c(ID))) |>
  cols_align(align = "center", columns = everything()) |>
  cols_align(align = "left", columns = c(ID)) |>
  fmt_markdown(columns = everything()) |>
  tab_spanner(label = "Outcome", columns = c(lived_after)) |>
  tab_spanner(label = "Covariates", columns = c(sex, year_elected, election_age))
```

Like all aspects of a data science problem, the Preceptor Table evolves as we work on the problem.

### Exercise 14

In your QMD, load the **tidyverse** and the **primer.data** packages in a new code chunk. Label it as the setup code chunk by adding `#| label: setup`. Render the file.

Notice that the file does not look good because the code is visible and there are annoying messages. To take care of this, add `#| message: false` to remove all the messages in the setup chunk. Also add the following to the YAML header to remove all code echos from the whole file:

```         
execute: 
  echo: false
```

In the Console, run:

```         
show_file("tutorial-9.qmd", start = -5)
```

CP/CR.

```{r wisdom-14}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

### 

Render again. Everything looks nice because we have added code to make the file look better and more professional.

### Exercise 15

In your own words, define "validity" as we use the term.

```{r wisdom-15}
question_text(NULL,
	message = "Validity is the consistency, or lack thereof, in the columns of the data set and the corresponding columns in the Preceptor Table.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Validity is always about the *columns* in the Preceptor Table and the data. Just because columns from these two different tables have the same *name* does not mean that they are the same *thing*.
### Exercise 16

<!-- XX: For the validity questions, specifics matter. There is always a reason why the outcome column in the data is not the same as the outcome columns in the Preceptor Table, even in the case of simple sampling. For example, consider a historical question connecting sex with presidential vote. Our data is a subset of our Preceptor Table. We have information on a few thousand voters and want to draw inferences about millions of other voters in the same election. But, even in this case, the outcome columns are different. The data is who people told a survey who they voted for. The Preceptor Table is who people actually did vote for. Those are not the same things. If they, in your view, are different enough than validity is violated. -->

Provide one reason why the assumption of validity might not hold for the outcome variable `XX` or for one of the covariates. Use the words "column" or "columns" in your answer.

```{r wisdom-16}
question_text(NULL,
	message = "In our data, the information about birth and death dates for *losing* candidates isn't nearly as well-documented a it is for *winning* candidates, so the information was gathered from untrustworthy sources.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

In order to consider the Preceptor Table and the data to be drawn from the same population, the columns from one must have a *valid correspondence* with the columns in the other. Validity, if true (or at least reasonable), allows us to construct the Population Table, which is the first step in Justice.

Because we control the Preceptor Table and, to a lesser extent, the original question, we can adjust those variables to be “closer” to the data that we actually have. This is another example of the iterative nature of data science. If the data is not close enough to the question, then we check with our boss/colleague/customer to see if we can modify the question in order to make the match between the data and the Preceptor Table close enough for validity to hold.

### Exercise 17

Over the course of this tutorial, we will be creating a summary paragraph. The purpose of this exercise is to write the first two sentences of that paragraph.

The first sentence is a general statement about the overall topic, mentioning both general class of the outcome variable and of at least one of the covariates. It is **not** connected to the initial "Imagine that you are XX" which set the stage for this project. That sentence can be rhetorical. It can be trite, or even a platitude. The purpose of the sentence to let the reader know, gently, about our topic.

The second sentence does two things. First, it introduces the data source. Second, it introduces the specific question. The sentence can't be that long. Important aspects of the data include when/where it was gather, how many observations it includes and the organization (if famous) which collected it.

Type your two sentences below.
<!-- SU: sentence not that good, fix later -->

```{r wisdom-17}
question_text(NULL,
	message = "Using data regarding candidate age, sex and longevity in the United States between 2000 and 2050, we seek to forecast candidate longevity post-election.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Read our answer. It will not be the same as yours. You can, if you want, change your answer to incorporate some of our ideas. Do not copy/paste our answer exactly. Add your two sentences, edited or otherwise, to your QMD, `Command/Ctrl + Shift + K`, and then commit/push.

## Justice
### 

*It is in justice that the ordering of society is centered.* - Aristotle


### Exercise 1

In your own words, name the four key components of Justice for working on a data science problem.

```{r justice-1}
question_text(NULL,
	message = "Justice concerns four topics: the Population Table, stability, representativeness, and unconfoundedness.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### Exercise 2

In your own words, define a Population Table.

```{r justice-2}
question_text(NULL,
	message = "The Population Table includes a row for each unit/time combination in the underlying population from which both the Preceptor Table and the data are drawn.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

We have not specified the rows for either the Preceptor Table or the Population Table concerning what sort of elections we are interested in. How about Senate races? Those are similar to gubernatorial elections in that they are state-wide and attract series candidates. 

But are there rows for other elections? What about mayorial elections? What about the town library committee? We need to make some choices here and, given that we only have data for gubernatorial elections, we need to be careful. Update:

> Using data from all deceased gubernatorial candidates in the United States between 1945 and 2012, we seek to forecast candidate longevity in state-wide US races post-election.

This is a change in our Preceptor Table. We are no longer interested in candiates outside the US, or those running outside of gubernatorial or Senate contests.


### Exercise 3

In your own words, define the assumption of "stability" when employed in the context of data science.

```{r justice-3}
question_text(NULL,
	message = "Stability means that the relationship between the columns in the Population Table is the same for three categories of rows: the data, the Preceptor Table, and the larger population from which both are drawn.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Lifespan changes over time. Therefore, our estimates for the future may need some adjustment — that is, to add years to our predicted life expectancy to account for a global change in lifespan over time.


### Exercise 4

Provide one reason why the assumption of stability might not be true in this case.

```{r justice-4}
question_text(NULL,
	message = "The average lifespan in 1950 is different than the average in 2020, so our lifespan in the future must be tweaked in regard to this discrepancy.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

In fact, between 1960 and 2015, life expectancy for the total population in the United States increased by almost 10 years. 

When we are confronted with this uncertainty, we can consider making our timeframe smaller.

*The longer the time period covered by the Preceptor Table (and the data), the more suspect the assumption of stability becomes.*


### Exercise 5

In your own words, define the assumption of "representativeness" when employed in the context of data science.

```{r justice-5}
question_text(NULL,
	message = "Representativeness, or the lack thereof, concerns two relationship, among the rows in the Population Table. The first is between the Preceptor Table and the other rows. The second is between our data and the other rows.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

*The more expansive your Preceptor Table, the more important the assumption of representativeness becomes.*

This data is **highly** representative of gubernatorial candidates (state officials), as it includes every candidate from 1945 to 2012. 

### Exercise 6

Provide one reason why the assumption of representativeness might not be true in this case.

```{r justice-6}
question_text(NULL,
	message = "Only the two candidates with the most votes are included in the data set. This is unfortunate, as we would ideally look at all gubernatorial candidates (regardless of votes).",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Given this data-implementation, we can either:

1) change the question we are answering (restricting it to just major party candidates) or 
2) assume that major party candidates are not systematically different from all candidates.

In this tutorial, we will be assuming Option 2.


### Exercise 7

In your own words, define the assumption of "un   confoundedness" when employed in the context of data science.

```{r justice-7}
question_text(NULL,
	message = "Unconfoundedness means that the treatment assignment is independent of the potential outcomes, when we condition on pre-treatment covariates.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

This assumption is only relevant for causal models. We describe a model as "confounded" if this is not true.


### Exercise 8

Summarize the state of your work so far in two or three sentences. Make reference to the data you have and to the question you are trying to answer. Feel free to copy from your answer at the end of the Wisdom Section. Mention at least one specific problem which casts doubt on your approach. 


```{r justice-8}
question_text(NULL,
	message = "Using data from all deceased gubernatorial candidates in the United States from elections held between 1945 and 2012, we seek to forecast candidate longevity in state-wide US races post-election. There is concern that longevity for gubernatorial candidates will differ significantly from that for candidates in Senate and other state-wide elections.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

Note: Your paragraph doesn't necessarily have to be as long as ours is :)

### 

Edit the summary paragraph in `five-parameters.qmd` as you see fit, but do not copy/paste our answer exactly. `Command/Ctrl + Shift + K`, and then commit/push.

## Courage
### 

*Courage is going from failure to failure without losing enthusiasm.* - Winston Churchill


### Exercise 1

In your own words, name the key goal of Courage and the process we use to get there.

```{r courage-1}
question_text(NULL,
	message = "Courage begins with the exploration and testing of different models. It concludes with the creation of a data generating mechanism.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### Exercise 2

Load the **brms** package. Load this into the Console as well, as we will be using it later in the Console.

```{r courage-2, exercise = TRUE}

```

```{r courage-2-hint-1, eval = FALSE}
library(...)
```

```{r courage-2-test, include = FALSE}
library(brms)
```

### Exercise 3

Load the **tidybayes** package.

```{r courage-3, exercise = TRUE}

```

```{r courage-3-hint-1, eval = FALSE}
library(...)
```

```{r courage-3-test, include = FALSE}
library(tidybayes)
```

### Exercise 4

Add `library(brms)` and `library(tidybayes)` to `five-parameters.qmd`. `Command/Ctrl + Shift + K`. At the Console, run:

```
show_file("five-parameters.qmd", pattern = "brms|tidybayes")
```

CP/CR.

```{r courage-4}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### Exercise 5

Pipe `governors` to `filter(year > 1945)`.

```{r courage-5, exercise = TRUE}

```

```{r courage-5-hint-1, eval = FALSE}
governors |> 
  ...(year > 1945)
```

```{r courage-5-test, include = FALSE}
governors |> 
  filter(year > 1945)
```

### 

There is some reason to be suspicious of the pre-1945 data. Moreover, the assumption of stability is more difficult to maintain the further back in time our data go.

### Exercise 6

Continue the pipe with `select(last_name, year, state, sex, lived_after, election_age)`.


```{r courage-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r courage-6-hint-1, eval = FALSE}
... |> 
  ...(last_name, year, state, ..., lived_after, election_age)
```

```{r courage-6-test, include = FALSE}
governors |> 
  filter(year > 1945) |> 
  select(last_name, year, state, sex, lived_after, election_age)
```

### 

It is useful to restrict the tibble to just the variables we will be using, the better to notice any problems.


### Exercise 7

We have taken the result of result of the previous pipe and assigned it to an object named `df`. Type `df1` below and hit "Run Code."

```{r courage-7, exercise = TRUE}

```

```{r courage-7-hint-1, eval = FALSE}
df1
```

```{r courage-7-test, include = FALSE}
df1
```

### 

We will use this tibble when we fit the model.


### Exercise 8

We will now begin creating the model. Observe the following model. 

````
fit_all <- brm(data = df1,
                 formula = lived_after ~ sex*election_age,
                 silent = 2,
                 refresh = 0,
                 seed = 13)
````

Type `fit_all` and hit "Run Code". This generates the same results as using `print(fit_all)`.

```{r courage-8, exercise = TRUE}

```

```{r courage-8-hint-1, eval = FALSE}
fit_all
```

```{r courage-8-test, include = FALSE}
print(fit_all)
```

### 

<!-- AC: What has the intercept increased from? IIRC this is the first time seeing one of this model.  -->

The intercept has increased, and is around 19. This is the intercept for females who are the average age. It means the average number of years lived after the election for women who are the average age is 19 or so. 

**Key point:** The interpretation of the intercepts only apply to candidates who are 52 year-old females. Candidates who are not 52 years-old will have a different expected number of years to live. The interpretation of the slope applies to everyone. In other words, the relationship between 
 and 
 is the same, regardless of your gender or how old you are.

<!-- AC: Also, there seem to be symbols missing between lines 998 and 1000.  -->

### Exercise 9

Run `family()` on `fit_all`. `family()` provides information about the "family" of the error term and the link between it and the dependent variable. 

```{r courage-9, exercise = TRUE}

```

```{r courage-9-hint-1, eval = FALSE}
family(...)
```

```{r courage-9-test, include = FALSE}
family(fit_all)
```

### 

In this case, we see that the family of the error term is Gaussian. In a Gaussian data generating mechanism, we have:
$\text{lifespan}_ i \sim \mathcal{N}(\mu, \sigma^2)$
Each governor $i$ who we sample has a certain average lifespan post-election. The value drawn is the number of years each governor lives after their term, with the distribution centered around the mean $\mu$ and spread determined by the variance $\sigma^2$. This is a common way to model continuous data like lifespans.

Also note how in our `brm()` call, we didn't specify the family as being `gaussian`. This worked because the default `family()` call in `brm()` is `gaussian`, so if we didn't specify the parameter, it would use this as the default.


### Exercise 10

Run `nobs()` on `fit_all`. The `nobs()` function returns the **n**umber of **obs**ervations.

```{r courage-10, exercise = TRUE}

```

```{r courage-10-hint-1, eval = FALSE}
nobs(...)
```

```{r courage-10-test, include = FALSE}
nobs(fit_all)
```

### 

`nobs()` is an extremely useful command that tells us the number of useful, non-error observations that we have in the data. In our case, it should have returned "1092" as its answer.


### Exercise 11

Run `formula()` on `fit_all`. `formula()` returns the statistical equation which relates the dependent variable to the independent variable(s). 

```{r courage-11, exercise = TRUE}

```

```{r courage-11-hint-1, eval = FALSE}
formula(...)
```

```{r courage-11-test, include = FALSE}
formula(fit_all)
```

### 

<!-- SD: Shouldn't this be introduced before we make the fitted model? I feel like that would make wayy more logical sense. -->

To look at interactions, we need 5 parameters, which is why we needed to wait until this chapter to introduce the concept. Here is the mathematical formula:

$$ lived\_after_i =  \beta_0 + \beta_1 male_i + \beta_2 c\_election\_age_i + 
\\ \beta_3 male_i *  c\_election\_age_i + \epsilon_i $$

* Our outcome variable is still $lived\_after_i$. We want to know how many years a candidate will live after an election. $male_i$ is one for male candidates and zero for female candidates. $c\_election\_age_i$ the number of years a candidate has lived before the election. In this model, we have a third predictor variable: the interaction between $male_i$ and $c\_election\_age_i$. 

* $\beta_0$ is the average number of years lived after the election for women.

* $\beta_1$ does not have a simple interpretation as a stand-alone parameter. It is a measure of how different women are from men. However, $\beta_0 + \beta_1$ has a straightforward meaning exactly analogous to the meaning of $\beta_0$. The sum is the average number of years lived after the election for *men*, who on the day of election, have been alive the average number of years of all candidates.

* $\beta_2$ is the coefficient of $c\_election\_age_i$. It it just the slope for women. It is the average difference in $lived\_after_i$ between two women, one of whom has an $c\_election\_age_i$ value of 1 greater than the other.

* $\beta_3$ alone is difficult to interpret. However, when it is added to $\beta_2$, the result in the slope for men.


### Exercise 12

Add the mathematical formula for your model to the QMD, using $\LaTeX$ math notation. When it looks good, `Command/Ctrl + Shift + K` to ensure that it works.

```
$$ lived\_after_i =  \beta_0 + \beta_1 male_i + \beta_2 c\_election\_age_i + 
\\ \beta_3 male_i *  c\_election\_age_i + \epsilon_i $$
```

Run `show_file("five-parameters.qmd", start = -5)` in the Console. CP/CR.

```{r courage-12}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

A key distinction when reading formulas is between:

Variables, always scripted with $i$, whose values (potentially) vary across individuals.

Parameters, never scripted with $i$, whose values are constant across individuals.

*Key point*: The interpretation of the intercepts only apply to candidates for whom $c\_election\_age_i = 0$. Candidates who are not `r round(mean(df1$election_age), 0)` years-old will have a different expected number of years to live. The interpretation of the slope applies to everyone. In other words, the relationship between $lived\_after_i$ and $c\_election\_age_i$ is the same, regardless of your gender or how old you are.


### Exercise 13

Create a new code chunk in `five-parameters.qmd`. Add two code chunk options: `#| label: model` and `#| cache: true`. Copy/paste the code from above for estimating the model using `brm()` into the code chunk, assigning the result to `fit_all`. Don't forget the code that makes `df1`. 

`Command/Ctrl + Shift + K`. It may take some time to render `five-parameters.qmd`, depending on how complex your model is. But, by including `cache: true` you cause Quarto to cache the results of the chunk. The next time you render `five-parameters.qmd`, as long as you have not changed the code, Quarto will just load up the saved fitted object.

To confirm, `Command/Ctrl + Shift + K` again. It should be quick.

At the Console, run:

```
show_file("five-parameters.qmd", start = -8)
```

CP/CR.

```{r courage-13}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

## Temperance
### 

Temperance is a tree which as for its root very little contentment, and for its fruit calm and peace.* - Buddha

### Exercise 1

In your own words, describe the use of Temperance in data science.

```{r temperance-1}
question_text(NULL,
	message = "Temperance uses the data generating mechanism to answer the question with which we began. Humility reminds us that this answer is always a lie. We can also use the DGM to calculate many similar quantities of interest, displaying the results graphically.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Courage gave us the data generating mechanism. Temperance guides us in the use of the DGM — or the “model” — we have created to answer the question with which we began. We create posteriors for the quantities of interest. 

### Exercise 2

Load the [**marginaleffects**](https://marginaleffects.com/) package.

```{r temperance-2, exercise = TRUE}

```

```{r temperance-2-hint-1, eval = FALSE}
library(...)
```

```{r temperance-2-test, include = FALSE}
library(marginaleffects)
```

### 

We should be modest in the claims we make. The posteriors we create are never the “truth.” The assumptions we made to create the model are never perfect. Yet decisions made with flawed posteriors are almost always better than decisions made without them.


### Exercise 3

What is the specific question we are trying to answer? 

```{r temperance-3}
question_text(NULL,
	message = "What is the causal effect of how many years a governor will live after being elected based off of sex?",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Data science projects almost always begin with a broad topic of interest. Yet, in order to make progress, we need to drill down to a specific question. This leads to the creation of a data generating mechanism, which can now be used to answer lots of questions, thus allowing us to explore the original topic more broadly.


### Exercise 4

Enter this code into the exercise code block and hit "Run Code."

```
plot_predictions(fit_all, 
                 condition = "sex")
```               

```{r temperance-4, exercise = TRUE}

```

```{r temperance-4-hint-1, eval = FALSE}
plot_predictions(fit_all, 
                 condition = ...))
```

```{r temperance-4-test, include = FALSE}
plot_predictions(fit_all, 
                 condition = "sex")
```

### 

In the plot above, we examine the predicted life expectancy (lived_after) for males and females (sex), with the corresponding confidence intervals to illustrate uncertainty in these estimates. The solid points represent the model’s predicted life expectancy for each group, while the vertical error bars show the 95% confidence intervals. By comparing these intervals, we can assess the reliability of the estimates. If the confidence intervals between the two groups overlap significantly, it suggests there is no statistically significant difference in life expectancy based on sex. However, if the intervals do not overlap, this would indicate a meaningful difference between the two groups. These estimates, derived from the linear model, provide insight into how sex influences life expectancy post-election.

### Exercise 5

We can compare the differences in ages a female vs male would live after being elected at different ages using `comparisons()`. 

```
comparisons(fit_all, newdata = governor)
```               

```{r temperance-5, exercise = TRUE}

```

```{r temperance-5-hint-1, eval = FALSE}
comparisons(fit_all, newdata = governor)
```

```{r temperance-5-test, include = FALSE}
comparisons(fit_all, newdata = governor)
```

### 

From this we can see that males are expected to live significantly fewer years than females after being elected, with an average difference of 11.7 years. This gap is statistically significant (p < 0.001), meaning the result is unlikely due to chance. The confidence interval suggests that the difference could range from 4.7 to 18.6 fewer years for males compared to females, indicating a consistent and substantial disparity in post-election life expectancy between the sexes.

### Exercise 6

Using `plot_comparisons` we can see the difference between life expectancy, and how it changes as election_age increases for both males and females.

```
plot_comparisons(fit_all,
  variables = "election_age",
condition = "sex")
```               

```{r temperance-6, exercise = TRUE}

```

```{r temperance-6-hint-1, eval = FALSE}
plot_comparisons(fit_all,
  variables = "election_age",
  condition = "sex") +
  scale_x_continuous(breaks = c(0, 1), labels = c("Male (0)", "Female (1)")) +
  labs(x = "Sex", y = "Predicted Life Expectancy")
```

```{r temperance-6-test, include = FALSE}
# plot_comparisons(fit_all,
#   variables = "election_age",
#   condition = "sex") +
#   scale_x_continuous(breaks = c(0, 1), labels = c("Male (0)", "Female (1)")) +
#   labs(x = "Sex", y = "Predicted Life Expectancy")
```

### 

From this we can see that the life expectancy for females has a greater range for the confidence intervals.The plot shows the estimated effect of the variable election_age on an outcome, conditioned by sex. For males, the estimate appears more negative with a narrow confidence interval, indicating a relatively precise estimate. In contrast, for females, the estimate is closer to zero but has a much wider confidence interval, reflecting greater uncertainty in the effect for this group. The overlap in confidence intervals between the two groups suggests that the difference in effect between the two sexes may not be statistically significant.

### Exercise 7

This plot shows the estimated effect of the variable sex on an outcome, conditioned by different values of election_age (40, 50, and 60). 
```
plot_comparisons(fit_all,
  variables = "sex",
condition = list(election_age = c(40, 50, 60)))
```               

```{r temperance-7, exercise = TRUE}

```

```{r temperance-7-hint-1, eval = FALSE}
plot_comparisons(fit_all,
  variables = "sex",
condition = list(election_age = c(40, 50, 60)))
```

```{r temperance-7-test, include = FALSE}
plot_comparisons(fit_all,
  variables = "sex",
condition = list(election_age = c(40, 50, 60)))
```

### 

In other words, the plot is comparing the estimated effect of sex at different ages. It indicates how the impact of sex on the outcome might differ for people of different ages. The "comparison" axis is likely representing the difference between the two groups defined by sex (e.g., male vs. female), with the confidence interval showing the uncertainty around these estimates.

### Exercise 8

Add `library(marginaleffects)` to your QMD setup code chunk. 

Create a new code chunk. Label it with `label: plot`. Copy/paste the code which creates your graphic. 

`Command/Ctrl + Shift + K` to ensure that it all works as intended.

At the Console, run:

```
tutorial.helpers::show_file("XX.qmd", start = -8)
```

CP/CR.

```{r temperance-8}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

### Exercise 9

Write the last sentence of your summary paragraph. It describes at least one quantity of interest (QoI) and provides a measure of uncertainty about that QoI. (It is OK if this QoI is not the one that you began with. The focus of a data science project often changes over time.)


```{r temperance-9}
question_text(NULL,
	message = "The quantity of interest in out problem is the causal effect of sex in terms of how many year the unit will live after being elected. The standard error of our data is 22.10477, indicating that the estimate of -53.3 years could fluctuate by approximately ±22.1 years due to variability in the data.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Add a final sentence to your summary paragraph in your QMD as you see fit, but do not copy/paste our answer exactly. `Command/Ctrl + Shift + K`.

### Exercise 10

Write a few sentences which explain why the estimates for the quantities of interest, and the uncertainty thereof, might be wrong. Suggest an alternative estimate and confidence interval, if you think either might be warranted.

```{r temperance-10}
question_text(NULL,
	message = "The estimates for the effect of sex and the associated uncertainty might be wrong due to potential omitted variables, such as health or socioeconomic factors, which could bias the results. Additionally, measurement error or multicollinearity between sex and election_age may inflate the standard error and widen the confidence interval, making the results less reliable. A more robust approach, such as bootstrapping or a Bayesian method, could yield more accurate estimates with reduced uncertainty, potentially narrowing the confidence interval.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 11

Rearrange the material in your QMD so that the order is graphic, paragraph, math and table. Doing so, of course, requires sensible judgment. For example, the code chunk which creates the fitted model must occur before the chunk which creates the graphic. `Command/Ctrl + Shift + K` to ensure that everything works.

At the Console, run:

```
tutorial.helpers::show_file("XX.qmd")
```

CP/CR.

```{r temperance-11}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

This is the version of your QMD file which your teacher is most likely to take a close look at.

### Exercise 12

Publish your rendered QMD to Rpubs. Choose a sensible slug. Copy/paste the resulting url below.

```{r temperance-12}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

Add `rsconnect` to the `.gitignore` file. You don't want your personal Rpubs details stored in the clear on Github. Commit/push everything.

### Exercise 13

Copy/paste the url to your Github repo.

```{r temperance-13}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

## Summary
### 

This tutorial covered [Chapter 9: Five Parameters](https://ppbds.github.io/primer/five-parameters.html) of [*Preceptor’s Primer for Bayesian Data Science: Using the Cardinal Virtues for Inference*](https://ppbds.github.io/primer/) by [David Kane](https://davidkane.info/). This tutorial was created by Sanaka Dash and David Kane.



```{r download-answers, child = system.file("child_documents/download_answers.Rmd", package = "tutorial.helpers")}
```
